<!DOCTYPE html>
<html lang="kr" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <script src="/webjars/jquery/3.3.1-2/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">
    <link rel="stylesheet" th:href="@{../../css/common.css}"/>
    <title>To Do List</title>
</head>
<body>

<div id="myDIV" class="header">
    <input type="text" id="myInput" placeholder="Title...">
    <span onclick="newElement()" class="button **is-large is-focused is-success is-rounded**"
          th:onclick="addtask()">Add</span>
</div>
<div class="container">
    <div class="panel-group" id="accordion">
        <div id="coll" class="panel panel-default">

        </div>
    </div>
</div>
<div id="list">
    <ul id="myUL">
    </ul>
</div>
<script type="text/javascript" th:src="@{/js/script.js}"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    $(document).ready(function () {
        loadTasks();
    });

    function loadTasks() {
        $("#coll").empty();
        $.ajax({
            url: "/api/tasks",
            type: "get",
            success: function (data) {
                console.log(data.length);
                for (var i = 0; i < data.length ; i++) {
                    var coll = $('<div class="panel-heading">\n' +
                        '            <h4 class="panel-title">\n' +
                        '                <a data-toggle="collapse" data-parent="#accordion" href="#' + data[i].id + '">' + data[i].title + '</a>\n' +
                        '            </h4>\n' +
                        '        </div>\n' +
                        '        <div id="' + data[i].id + '" class="panel-collapse collapse">\n' +
                        '            <div class="panel-body">메모: ' + data[i].content + '<button class="btn btn-dark" style="float: right;">수정</button> </div>\n' +
                        '            <div class="panel-body">등록일: ' + data[i].regdate + '<button class="btn btn-dark" style="float: right;">수정</button> </div>\n' +
                        '            <div class="panel-body">언제까지: ' + data[i].findate + '<button class="btn btn-dark" style="float: right;">수정</button> </div>\n' +
                        '        </div>');
                    coll.appendTo($('#coll'))
                    // var myUL = $('<li>' + data[i].title + '<span class="close">×</span></li>');
                    // myUL.appendTo($('#list ul'));
                }
            },
            error: function (err) {
                if (err.status === 400) {
                    alert("400 Bad Request. 값을 불러올 수 없습니다.");
                } else if (err.status === 500) {
                    alert("500 Internal Server Error. 서버에 문제가 발생했습니다.");
                }
            }
        })
    }

    function addtask() {
        let title = document.getElementById('myInput').value;
        if (title === '') {
            alert("제목을 입력 해 주세요!")
        }
        console.log(title);
        var data = {
            title: title
        };
        var jsonData = JSON.stringify(data);
        $.ajax({
            url: "/api/newtasks",
            type: "post",
            data: jsonData,
            async: true,
            contentType: "application/json",
            success: function (data) {
                loadTasks();
                document.getElementById("myInput").value = "";
            },
            error: function (err) {

            }
        })
    }


    /*]]>*/
</script>
</body>
</html>